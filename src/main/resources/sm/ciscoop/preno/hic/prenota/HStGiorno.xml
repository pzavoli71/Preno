<?xml version="1.0" encoding="UTF-8" ?>
<stampa xmlns="http://www.ciscoop.sm/stampa/2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.ciscoop.sm/stampa/2"  >
<head>
<include src="colors.xml" />
<include src="fonts.xml" />
  <document 
  	foglio="A4" 
  	orientamento="orizzontale" 
  	margini="0.5cm 0.5cm 0.1cm 0.5cm"
  	title="Stampa prenotazioni mensili">
  </document>
  
<query><![CDATA[

select t.*, TT.NomeTpTrasporto
FROM
(	
select 1 as ar, g.IdGiorno, DtGiorno, Destinazione, NotaGiorno,
bRagazzo, NomeSoggetto, IdTpTrasporto
from giorno g inner join soggar sa on sa.IdGiorno = g.IdGiorno
inner join Soggetto s on s.IdSoggetto = sa.IdSoggetto
WHERE sa.ar in ( 1,3)
UNION 
select 2 as ar, g.IdGiorno, DtGiorno, Destinazione, NotaGiorno,
bRagazzo, NomeSoggetto, IdTpTrasporto
from giorno g inner join soggar sa on sa.IdGiorno = g.IdGiorno
inner join Soggetto s on s.IdSoggetto = sa.IdSoggetto
WHERE sa.ar in ( 2,3)
) t
inner join TipoTrasporto tt on tt.IdTpTrasporto = t.IdTpTrasporto
 AND DtGiorno >= $DtInizio
 AND DtGiorno <= $DtFine
 and tt.IdTpTrasporto = $IdTpTrasporto
order by DtGiorno, ar, bragazzo desc


]]>
</query>
 	<!--query name="Rinnovo"><![CDATA[
 		select top 1 *
		FROM [opec].[dbo].[LIC_Rinnovo]
		where IdLicenza = $IdLicenza and CdTassaLicenza = 1
		  and AnnoRinnovo =
		  (SELECT Max(AnnoRinnovo) as AnnoMax
 		FROM [opec].[dbo].[LIC_Rinnovo]
  		where IdLicenza = $IdLicenza
   		and CdTassaLicenza = 1
		and DtInizio = '{{format($DtInizio,"yyyyMMdd")}}'		
		)
 	]]>
 	</query-->  
</head>

<body textmode="text" >
  	<pageHeader height="0.02cm">
	<table cols="1" width="18cm"  grid="0.3 solid bianco"  halign="center">
		    <cell border="0" paddingBottom="0">
		      <text refFont="hf_bold">PRENOTAZIONI RAGAZZI PER TRASPORTO FEDERAZIONE CALCIO <span refFont="hfsmall_italic">per: <field value="trim(#nometptrasporto)"></field></span></text>
		    </cell>
	</table>
</pageHeader>
<table cols="8" grid="0.1 solid #232323" marginTop="0">
	<group name="giornate" keys="idgiorno">
		<cell valign="top" paddingTop="0">
<table cols="1" marginTop="0"> 
			<cell halign="center" refFont="rsm_bold8" paddingTop="0.1cm" paddingBottom="0.1cm" border="0.1 solid #232323"><field value="format(giornate#dtgiorno, 'EEEE, dd MMMM')"/></cell>
<cell halign="center" border="0.1 solid #232323"><if test="!isnull(giornate#destinazione)"><text refFont="rsm_mini7"><field value="giornate#destinazione"/></text></if>
<if test="!isnull(giornate#notagiorno)"><text refFont="rsm_mini7"><field value="giornate#notagiorno"/></text></if></cell>
			<group name="tratta" keys="ar">			
				<if test="tratta#ar = 1"><cell halign="center" refFont="rsm_bold8">Andata</cell></if>
				<if test="tratta#ar = 2"><cell halign="center" refFont="rsm_bold8">Ritorno</cell></if>
				<cell padding="0"><text marginLeft="0" halign="center">
				<group block="false" name="soggetti" keys="ar,bragazzo,nomesoggetto"><span>  <field value="rtrim(soggetti#nomesoggetto)"/><if test="soggetti#bragazzo = 0"><span>(Autista)</span>     </if> </span></group></text>
				</cell>
			</group>
		</table>
		</cell>
	</group>	
</table></body>
</stampa>
